<!DOCTYPE html>
<html lang="zh-CN" data-theme="dark">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Project Brain - 智能项目协作平台">
    <meta name="author" content="Project Brain Team">
    <meta name="theme-color" content="#4F46E5">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Project Brain">
    <link rel="icon" type="image/svg+xml" href="/static/favicon.svg">
    <link
      rel="preconnect"
      href="https://fonts.googleapis.com"
    />
    <link
      rel="preconnect"
      href="https://fonts.gstatic.com"
      crossorigin
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/static/styles.css" />
    <script
      type="module"
      src="/static/app.js"
      defer
    ></script>
    <style>
        /* 关键渲染路径优化 - 内联关键CSS */
        :root {
            --primary: #4F46E5;
            --primary-light: #6366F1;
            --secondary: #10B981;
            --accent: #F43F5E;
            --warning: #FBBF24;
            --info: #3B82F6;
            --radius-md: 8px;
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Space Grotesk', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            min-height: 100vh;
        }
        
        /* 骨架屏样式 */
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s infinite;
        }
        
        @keyframes skeleton-loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
    </style>
  </head>
  <body
    data-default-user="{{ default_user }}"
    data-default-session="{{ default_session }}"
    data-multi-agent="{{ 'true' if multi_agent else 'false' }}"
  >
    <div class="page-shell">
        <!-- 粒子效果背景容器 -->
        <div id="particles-js" class="particles-container"></div>
        
        <header class="hero glass">
            <div>
                <!-- 项目logo和系统操作区域 -->
                <div class="logo-container">
                    <p class="eyebrow">mem0 · AI Project Brain</p>
                    <div class="system-actions">
                        <button id="theme-toggle" class="theme-button" aria-label="切换主题">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
                            </svg>
                        </button>
                        <button id="help-button" class="help-button" aria-label="帮助">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                
                <!-- 标题和副标题 -->
                <h1 class="gradient-text">Multi Agent 项目管理指挥台</h1>
                <p class="subtitle">
                    实时协调产品 / 算法 / 方案专家，结合长期记忆输出结构化决策。
                </p>
                
                <!-- 专家徽章区域 -->
                <div class="agent-badges">
                    <h3>系统智能体：</h3>
                    {% for agent_id, profile in project_brain.items() %}
                    <span class="badge project-brain">
                      {{ profile.name }}
                      <small>{{ profile.type }}</small>
                    </span>
                    {% endfor %}
                    <h3>专家团队：</h3>
                    {% for agent_id, profile in specialist_agents.items() %}
                    <span class="badge specialist" data-agent-id="{{ agent_id }}">
                      {{ profile.name }}
                      <small>{{ profile.type }}</small>
                    </span>
                    {% endfor %}
                </div>
            </div>
            
            <!-- 系统状态区域 -->
            <div class="status-block">
                <div id="status-indicator">待命</div>
                <small>实时显示后端状态</small>
                <!-- 性能指标显示 -->
                <div class="performance-metrics">
                    <span id="memory-usage">内存: —</span>
                    <span id="latency-label">延迟: —</span>
                </div>
            </div>
        </header>

      <main class="layout">
        <section class="panel glass conversation">
          <div class="panel-head">
            <div class="flex justify-between items-center">
              <h2>对话流</h2>
              <div class="chat-mode-selector">
                <label>
                  <input type="radio" name="chatMode" value="project_brain" checked>
                  项目大脑
                </label>
                <label>
                  <input type="radio" name="chatMode" value="specialist">
                  专家选择
                  <select id="specialistSelect" disabled>
                    <option value="">选择专家...</option>
                    {% for agent_id, profile in specialist_agents.items() %}
                    <option value="{{ agent_id }}">{{ profile.name }}</option>
                    {% endfor %}
                  </select>
                </label>
              </div>
              <button class="ghost-btn" id="btn-clear">清空</button>
            </div>
          </div>
          <ol id="chat-log" class="chat-log"></ol>
        </section>

        <section class="panel glass insights">
          <div class="panel-head">
            <h2>项目洞察</h2>
          </div>
          <div class="insight-block">
            <h3>项目大脑摘要</h3>
            <p id="project-summary" class="muted">尚未生成</p>
          </div>
          <div class="insight-block">
            <h3>专家大脑反馈</h3>
            <ul id="specialist-list" class="specialist-list">
              <li class="muted">等待分析...</li>
            </ul>
          </div>
          <div class="insight-block meta">
            <h3>引用信息</h3>
            <dl>
              <div>
                <dt>记忆命中</dt>
                <dd id="memory-usage">—</dd>
              </div>
              <div>
                <dt>协作代理</dt>
                <dd id="collaborators">—</dd>
              </div>
            </dl>
          </div>
        </section>
      </main>

      <section class="panel glass composer">
        <form id="chat-form">
          <div class="form-grid">
            <label>
              用户 ID
              <input type="text" name="user_id" value="{{ default_user }}" />
            </label>
            <label>
              会话 ID
              <input type="text" name="session_id" value="{{ default_session }}" />
            </label>
          </div>
          <textarea
            name="message"
            id="messageInput"
            rows="4"
            placeholder="描述你的项目目标、约束与期望成果（支持多行输入）"
            required
            spellcheck="false"
          ></textarea>
          <div id="currentAgentInfo" class="current-agent-info">
            当前交互: <span id="activeAgentName">项目大脑</span>
          </div>
          <div class="form-actions">
            <span id="latency-label" class="muted">—</span>
            <button type="submit" class="primary-btn">
              提交给项目大脑
            </button>
          </div>
        </form>
      </section>
    </div>
  </body>
</html>

